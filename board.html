<section>
  <h2>7ちゃんねる</h2>
  <p>2ch風・実験用BBS</p>

  <form id="postForm">
    <input id="name" placeholder="名前（省略可）">
    <br>
    <textarea id="message" placeholder="書き込め" required></textarea>
    <br>
    <button type="submit">書き込む</button>
  </form>

  <hr>

  <div id="posts"></div>
</section>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = "https://hzbxrludkptmhfxekiaw.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6YnhybHVka3B0bWhmeGVraWF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczOTMxODYsImV4cCI6MjA4Mjk2OTE4Nn0.aJV2wb8a2ITMBL4hNjJ425ekwi6ZBfSZQmWMYLlWQU8";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const postsDiv = document.getElementById("posts");

async function loadPosts() {
  const { data } = await supabase
    .from("posts")
    .select("*")
    .order("created_at", { ascending: false });

  postsDiv.innerHTML = "";
  data.forEach(p => {
    const div = document.createElement("div");
    div.innerHTML = `
      <strong>${p.name || "風吹けば名無し"}</strong><br>
      ${p.message}<hr>
    `;
    postsDiv.appendChild(div);
  });
}

document.getElementById("postForm").addEventListener("submit", async e => {
  e.preventDefault();

  await supabase.from("posts").insert({
    name: document.getElementById("name").value,
    message: document.getElementById("message").value
  });

  e.target.reset();
  loadPosts();
});

loadPosts();
</script>
